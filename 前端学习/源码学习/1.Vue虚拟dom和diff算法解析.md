## 什么是虚拟DOM？

虚拟DOM（Virtual   Dom），也就是我们常说的虚拟节点，是用JS对象来模拟真实DOM中的节点，该对象包含了真实DOM的结构及其属性，用于对比虚拟DOM和真实DOM的差异，从而进行局部渲染来达到优化性能的目的。

```html
<div class="box">
  <h3>我是一个标题</h3>
  <ul>
    <li>牛奶</li>
    <li>咖啡</li>
    <li>可乐</li>
  </ul>
</div>
```

```js
{
  "sel": "div",
  "data": {
    "class": {
      "box": true
    }
  },
  "children": [
    {
      "sel": "h3",
      "data": {},
      "text": "我是一个标题"
    },
    {
      "sel": "ul",
      "data": {},
      "children": [
        {
          "sel": "li",
          "data": {},
          "text": "牛奶"
        },
        {
          "sel": "li",
          "data": {},
          "text": "咖啡"
        },
        {
          "sel": "li",
          "data": {},
          "text": "可乐"
        }
      ]
    }
  ]
}

```

## 虚拟DOM的作用是什么？

兼容性好。因为Vnode本质是JS对象，所以不管Node还是浏览器环境，都可以操作；
减少了对Dom的操作。页面中的数据和状态变化，都通过Vnode对比，只需要在比对完之后更新DOM，不需要频繁操作，提高了页面性能；

## 虚拟DOM和真实DOM的区别？

说到这里，那么虚拟DOM和真实DOM的区别是什么呢？总结大概如下：

- 虚拟DOM不会进行回流和重绘；
- 真实DOM在频繁操作时引发的回流重绘导致性能很低；
- 虚拟DOM频繁修改，然后一次性对比差异并修改真实DOM，最后进行依次回流重绘，减少了真实DOM中多次回流重绘引起的性能损耗；
- 虚拟DOM有效降低大面积的重绘与排版，因为是和真实DOM对比，更新差异部分，所以只渲染局部；


## 虚拟DOM是如何实现的降低操作真实DOM的频率的？

当数据变化时，vue如何来更新视图的？其实很简单，一开始会根据真实DOM生成虚拟DOM，当虚拟DOM某个节点的数据改变后会生成一个新的Vnode，然后采用DOM Diff算法对VNode和oldVnode进行比较，算出应该如何最小量更新，最后反映到真正的DOM上，最后再使得oldVnode的值为Vnode，因此diff是发生在虚拟DOM上的diff

## 以snabbdom的源码为例进行探究

snabbdom是著名的虚拟DOM库，是diff算法的鼻祖，Vue源码借鉴了snabbdom；

官方git：https://github.com/snabbdom/snabbdom

npm: npm i -D snabbdom

### 主要从以下三个方面进行探究

- 研究1：虚拟DOM如何被渲染函数（h函数）产生？我们要手写h函数
- 研究2：diff算法原理
- 研究3：虚拟DOM如何通过diff变为真正的DOM的(事实上，虚拟DOM变回真正的DOM，是涵盖在diff算法里面的)

> DOM如何变为虚拟DOM，属于模板编译原理范畴，在此不做探究


## h函数-产生Vnode虚拟节点

## patch函数，Vnode虚拟节点上真实DOM树
### createElement函数，虚拟节点转为真实DOM
### patchVnode函数，相同节点的子节点比较
### updateChildren函数，节点diff算法的实现


## 参考文章
https://www.jb51.net/article/194147.htm